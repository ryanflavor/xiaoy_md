# Story 2.4.4: Throughput & Observability (MPS, Counters, Optional Metrics)
**故事 2.4.4：吞吐与可观测性（MPS、计数器、可选指标）**

## Status
Approved

## Story
**As a** Tech Lead,
**I want** basic throughput and reliability observability,
**so that** we can measure messages/second (MPS), publish failures, and dropped ticks to prepare for Story 2.5 performance goals.

## Acceptance Criteria
1. 服务以约 5 秒滚动窗口输出 MPS（messages per second）与累计计数器：`published_ticks_total`、`dropped_ticks_total`、`failed_publishes_total`。
2. 日志为结构化 JSON，包含 `event=mps_report`、`window_seconds`、`mps_window`、`published_total`、`dropped_total`、`failed_total`、`nats_connected` 等字段。
3. 可选：在 monitoring profile 启用时，通过 Prometheus exporter 或轻量 HTTP 端点暴露指标。
4. 单元测试验证计数器增量与基本 reporter 行为；日志格式做冒烟验证。

## Tasks / Subtasks
- [ ] 在服务/发布路径添加计数器与周期 reporter（异步任务）（AC: 1, 2）
- [ ] 接线增量点：成功发布、适配器丢弃 tick、发布异常（AC: 1）
- [ ] 可选：监控 profile 下的 Prom 指标（AC: 3）
- [ ] 单元测试（AC: 4）

## Dev Notes
- Keep overhead negligible; do not block hot path.
- Respect existing logging standards and Asia/Shanghai timestamp policy for serialized times.

## Dev Agent Record

### Agent Model Used
TBD

### Debug Log References
- Expect `mps_report` log every ~5s with counters and windowed metrics.

### Completion Notes List
- TBD

### File List
- To be populated by Dev Agent during implementation

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-10 | 0.1 | Draft story created | Bob (Scrum Master) |
